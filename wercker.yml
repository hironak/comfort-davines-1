box: wercker/ubuntu12.04-ruby2.0.0
services:
  - wercker/mysql
build:
  steps:
    - bundle-install
    - rails-database-yml
    - script:
        name: minitest
        code: bundle exec rake
  after-steps:
    - bundle-package
    - wouter/irc-notify:
        server: irc.freenode.net
        port: 6667
        nickname: hackers-bot
        channel: hackers-jp
deploy:
  steps:
    - bundle-install
    - script:
        name: write env var
        code: |-
          export CAP_PRIVATE_KEY=`mktemp`
          echo -e $DEPLOY_KEY_PRIVATE > $CAP_PRIVATE_KEY
          cat $CAP_PRIVATE_KEY
    - wercker/cap:
        stage: staging
