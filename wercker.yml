box: wercker/rvm
services:
  - wercker/mysql
build:
  steps:
    - bundle-install
    - rails-database-yml
    - script:
        name: minitest
        code: bundle exec rake
  after-steps:
    - wouter/irc-notify:
        server: irc.freenode.net
        port: 6667
        nickname: hackers-bot
        channel: hackers-jp
deploy:
  steps:
    - bundle-install
    - script:
        name: Write SSH Key
        code: |-
          echo -e $DEPLOY_KEY_PRIVATE > ~/.ssh/id_rsa
          chmod 0600 ~/.ssh/id_rsa
    - script:
        name: database.yml
        code: cp ./config/database.yml ./tmp/deploy/config/database.yml
    - wercker/cap:
        stage: staging
  after-steps:
    - wouter/irc-notify:
        server: irc.freenode.net
        port: 6667
        nickname: hackers-bot
        channel: hackers-jp
