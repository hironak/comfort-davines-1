box: wercker/rvm
services:
  - wercker/mysql
build:
  steps:
    - script:
        name: clear cache
        code: sudo rm -rf $WERCKER_CACHE_DIR
    - bundle-install
    - rails-database-yml
    - script:
        name: minitest
        code: bundle exec rake
  after-steps:
    - wouter/irc-notify:
        server: irc.freenode.net
        port: 6667
        nickname: hackers-bot
        channel: hackers-jp
deploy:
  steps:
    - bundle-install
    - script:
        name: write env var
        code: |-
          export CAP_PRIVATE_KEY=`mktemp`
          echo -e $DEPLOY_KEY_PRIVATE > $CAP_PRIVATE_KEY
    - wercker/cap:
        stage: staging
