box: wercker/rvm
services:
  - wercker/mysql
build:
  steps:
    - bundle-install
    - rails-database-yml
    - script:
        name: minitest
        code: bundle exec rake
  after-steps:
    - 1syo/idobata-notify@0.1.1:
        token: 958cd6e5-1efe-4dad-bfda-fd5089871b3a
    - wouter/irc-notify:
        server: irc.freenode.net
        port: 6667
        nickname: hackers-bot
        channel: hackers-jp
deploy:
  steps:
    - bundle-install
    - script:
        name: Write SSH Key
        code: |-
          echo -e $DEPLOY_KEY_PRIVATE > ~/.ssh/id_rsa
          chmod 0600 ~/.ssh/id_rsa
    - wercker/cap
  after-steps:
    - 1syo/idobata-notify@0.1.1:
        token: 958cd6e5-1efe-4dad-bfda-fd5089871b3a
    - wouter/irc-notify:
        server: irc.freenode.net
        port: 6667
        nickname: hackers-bot
        channel: hackers-jp
